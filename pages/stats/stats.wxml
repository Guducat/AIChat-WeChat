<!--pages/stats/stats.wxml-->
<view class="stats-container">
  <!-- å¤´éƒ¨æ ‡é¢˜ -->
  <view class="stats-header">
    <view class="header-title">ä½¿ç”¨ç»Ÿè®¡</view>
    <view class="header-subtitle">Tokenæ¶ˆè€—ä¸è´¹ç”¨ç»Ÿè®¡</view>
  </view>

  <!-- æ€»ä½“ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="card-title">æ€»ä½“ç»Ÿè®¡</view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value">{{tokenStats.totalTokens || 0}}</view>
        <view class="stat-label">æ€»Tokenæ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">Â¥{{tokenStats.totalCostDisplay}}</view>
        <view class="stat-label">æ€»è´¹ç”¨</view>
      </view>
    </view>
    <view class="last-updated">
      æœ€åæ›´æ–°ï¼š{{tokenStats.lastUpdated}}
    </view>
  </view>

  <!-- æ¯æ—¥ç»Ÿè®¡ -->
  <view class="stats-card" wx:if="{{dailyStats.length > 0}}">
    <view class="card-title">æœ€è¿‘7å¤©</view>
    <view class="daily-stats">
      <view 
        wx:for="{{dailyStats}}" 
        wx:key="date" 
        class="daily-item"
      >
        <view class="daily-date">{{item.date}}</view>
        <view class="daily-info">
          <view class="daily-tokens">{{item.tokens}}</view>
          <view class="daily-cost">{{item.cost}}</view>
          <view class="daily-count">{{item.count}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¯æœˆç»Ÿè®¡ -->
  <view class="stats-card" wx:if="{{monthlyStats.length > 0}}">
    <view class="card-title">æœ€è¿‘6ä¸ªæœˆ</view>
    <view class="monthly-stats">
      <view 
        wx:for="{{monthlyStats}}" 
        wx:key="month" 
        class="monthly-item"
      >
        <view class="monthly-month">{{item.month}}</view>
        <view class="monthly-info">
          <view class="monthly-tokens">{{item.tokens}}</view>
          <view class="monthly-cost">{{item.cost}}</view>
          <view class="monthly-count">{{item.count}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ–‡ä»¶è®°å½• -->
  <view class="stats-card" wx:if="{{fileRecords.length > 0}}">
    <view class="card-title">æœ€è¿‘ä¸Šä¼ çš„æ–‡ä»¶</view>
    <view class="file-records">
      <view 
        wx:for="{{fileRecords}}" 
        wx:key="fileId" 
        class="file-item"
        bind:tap="onPreviewFile"
        data-url="{{item.fileUrl}}"
        data-type="{{item.fileType}}"
      >
        <view class="file-info">
          <view class="file-name">{{item.fileName}}</view>
          <view class="file-meta">
            <text class="file-size">{{item.formattedFileSize}}</text>
            <text class="file-time">{{item.formattedUploadTime}}</text>
          </view>
        </view>
        <view class="file-type">{{item.fileType}}</view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <van-button 
      type="default" 
      size="small"
      bind:click="onShareStats"
      custom-class="action-btn"
    >
      åˆ†äº«ç»Ÿè®¡
    </van-button>
    <van-button 
      type="warning" 
      size="small"
      bind:click="onShowClearDialog"
      data-type="tokens"
      custom-class="action-btn"
    >
      æ¸…ç©ºTokenç»Ÿè®¡
    </van-button>
    <van-button 
      type="danger" 
      size="small"
      bind:click="onShowClearDialog"
      data-type="files"
      custom-class="action-btn"
    >
      æ¸…ç©ºæ–‡ä»¶è®°å½•
    </van-button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!tokenStats.totalTokens && fileRecords.length === 0}}">
    <view class="empty-icon">ğŸ“Š</view>
    <view class="empty-text">æš‚æ— ä½¿ç”¨ç»Ÿè®¡</view>
    <view class="empty-desc">å¼€å§‹å¯¹è¯åå°†æ˜¾ç¤ºTokenæ¶ˆè€—å’Œè´¹ç”¨ç»Ÿè®¡</view>
  </view>
</view>

<!-- æ¸…ç©ºç¡®è®¤å¯¹è¯æ¡† -->
<van-dialog
  show="{{showClearDialog}}"
  title="ç¡®è®¤æ¸…ç©º"
  message="{{clearType === 'tokens' ? 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰Tokenç»Ÿè®¡æ•°æ®å—ï¼Ÿ' : 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶è®°å½•å—ï¼Ÿ'}}"
  show-cancel-button
  bind:confirm="onConfirmClear"
  bind:cancel="onCancelClear"
/>

<!-- Toastç»„ä»¶ -->
<van-toast id="van-toast" />
